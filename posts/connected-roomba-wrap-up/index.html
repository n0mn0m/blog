<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  <link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />
  
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-icon.png' rel="apple-touch-icon" sizes="180x180" />
  

  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.css"
    rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <link href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;site.css' rel="stylesheet" />

  
  

  <title>
     burningdaylight | Connected Roomba - Wrapping Up 
  </title>

  <script crossorigin="anonymous" src="https://kit.fontawesome.com/201b8d5e05.js"></script>

  
</head>

<body class="has-background-white">
  
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item has-text-weight-bold" href="/">burningdaylight</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;'>
            Home
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts'>
            Posts
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;docs'>
            Docs
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;github.com&#x2F;n0mn0m'>
            Repos
          </a>
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  

  
  

  
<section class="section pb-0">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article>
          <h1 class="title">Connected Roomba - Wrapping Up</h1>
          <h2 class="subtitle"></h2>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="fas fa-user"></i>
    </span>
     published on
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2019-08-04'>August 04, 2019</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    3 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    489 words
  </p>

            </div>
            <div class="column is-4">
              
            </div>
            <div class="column is-8 has-text-right-desktop">
               
  <p>
    <span class="has-text-black has-text-weight-normal">Tags:</span>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;circuitpython&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        circuitpython
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;python&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        python
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;hardware&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        hardware
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;irobot&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        irobot
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;roomba&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        roomba
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;adafruit&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        adafruit
      </a>
    
  </p>
 
            </div>
          </div>
          <div class="content has-text-justified">
            <p>With everything working I wanted to make sure I didn't have to reset everything
anytime an odd decode error occurs, something loses and regains power, etc. For
the Feather attached to the Roomba handling this is pretty straight forward.
Everything is already running in a super loop, so all I need to add is a
<code>try/except</code> block to the <code>while</code> loop and discard errors. Doing the same thing
for the Pi was again straight forward, but since it is running Linux I needed
to make sure the applications handled failures, and that the scripts restart if
the board restarts, the OS bounces, etc.</p>
<p>Similar to the Feather code I wrapped everything in a while loop, added
exception handlers, but I also added logging so that I could understand if
errors are created by the OS, the code or something else:</p>
<pre style="background-color:#2b303b;">
<code class="language-python" data-lang="python"><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">logging
</span><span style="color:#db9d63;">...

</span><span style="color:#eb6772;">LOG_FORMAT </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;</span><span style="color:#db9d63;">%(</span><span style="color:#eb6772;">asctime</span><span style="color:#db9d63;">)s</span><span style="color:#9acc76;">:</span><span style="color:#db9d63;">%(</span><span style="color:#eb6772;">levelname</span><span style="color:#db9d63;">)s</span><span style="color:#9acc76;">:</span><span style="color:#db9d63;">%(</span><span style="color:#eb6772;">message</span><span style="color:#db9d63;">)s</span><span style="color:#9acc76;">&quot;
</span><span style="color:#abb2bf;">logging.</span><span style="color:#eb6772;">basicConfig</span><span style="color:#abb2bf;">(
    </span><span style="color:#eb6772;">filename</span><span style="color:#adb7c9;">=</span><span style="color:#9acc76;">&quot;/home/pi/logs/button.log&quot;</span><span style="color:#abb2bf;">,
    </span><span style="color:#eb6772;">level</span><span style="color:#adb7c9;">=</span><span style="color:#abb2bf;">logging.</span><span style="color:#eb6772;">INFO</span><span style="color:#abb2bf;">,
    </span><span style="color:#eb6772;">format</span><span style="color:#adb7c9;">=</span><span style="color:#eb6772;">LOG_FORMAT</span><span style="color:#abb2bf;">,
    </span><span style="color:#eb6772;">datefmt</span><span style="color:#adb7c9;">=</span><span style="color:#9acc76;">&quot;</span><span style="color:#db9d63;">%m</span><span style="color:#9acc76;">/</span><span style="color:#db9d63;">%d</span><span style="color:#9acc76;">/</span><span style="color:#db9d63;">%Y %I</span><span style="color:#9acc76;">:</span><span style="color:#db9d63;">%M</span><span style="color:#9acc76;">:</span><span style="color:#db9d63;">%S %p</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">,
)
logger </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">logging.</span><span style="color:#eb6772;">getLogger</span><span style="color:#abb2bf;">(__name__)

...

</span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">__name__ </span><span style="color:#adb7c9;">== </span><span style="color:#9acc76;">&quot;__main__&quot;</span><span style="color:#abb2bf;">:
    </span><span style="color:#cd74e8;">while </span><span style="color:#db9d63;">True</span><span style="color:#abb2bf;">:
        </span><span style="color:#cd74e8;">try</span><span style="color:#abb2bf;">:
            </span><span style="color:#db9d63;">...
        </span><span style="color:#cd74e8;">except </span><span style="color:#abb2bf;">BaseException </span><span style="color:#cd74e8;">as </span><span style="color:#abb2bf;">e:
            logger.</span><span style="color:#eb6772;">exception</span><span style="color:#abb2bf;">(e)
            </span><span style="color:#cd74e8;">pass

</span></code></pre>
<p>And since this is running on Linux setting up <code>cron</code> to handle starting the
applications after reboot was one command away.</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#eb6772;">sudo</span><span style="color:#abb2bf;"> crontab</span><span style="color:#eb6772;"> -e

@reboot</span><span style="color:#abb2bf;"> cd /home/pi/ </span><span style="color:#adb7c9;">&amp;&amp; </span><span style="color:#eb6772;">/home/pi/.virtualenvs/lora-pi/bin/python</span><span style="color:#abb2bf;"> /home/pi/projects/roomba_supervisor/button_listener.py </span><span style="color:#db9d63;">2</span><span style="color:#adb7c9;">&gt;&amp;</span><span style="color:#db9d63;">1 </span><span style="color:#adb7c9;">&gt;&gt;</span><span style="color:#abb2bf;"> /home/pi/logs/button.log
</span><span style="color:#eb6772;">@reboot</span><span style="color:#abb2bf;"> cd /home/pi/ </span><span style="color:#adb7c9;">&amp;&amp; </span><span style="color:#eb6772;">/home/pi/.virtualenvs/lora-pi/bin/python</span><span style="color:#abb2bf;"> /home/pi/projects/roomba_supervisor/sms_listener.py </span><span style="color:#db9d63;">2</span><span style="color:#adb7c9;">&gt;&amp;</span><span style="color:#db9d63;">1 </span><span style="color:#adb7c9;">&gt;&gt;</span><span style="color:#abb2bf;"> /home/pi/logs/sms.log
</span><span style="color:#eb6772;">@reboot</span><span style="color:#abb2bf;"> sleep 10 </span><span style="color:#adb7c9;">&amp;&amp; </span><span style="color:#5ebfcc;">cd</span><span style="color:#abb2bf;"> /home/pi/ </span><span style="color:#adb7c9;">&amp;&amp; </span><span style="color:#eb6772;">/home/pi/ngrok</span><span style="color:#abb2bf;"> http 5000 </span><span style="color:#db9d63;">2</span><span style="color:#adb7c9;">&gt;&amp;</span><span style="color:#db9d63;">1 </span><span style="color:#adb7c9;">&gt;&gt;</span><span style="color:#abb2bf;"> /home/pi/logs/ngrok.log
</span><span style="color:#eb6772;">@reboot</span><span style="color:#abb2bf;"> sleep 20 </span><span style="color:#adb7c9;">&amp;&amp; </span><span style="color:#eb6772;">curl</span><span style="color:#abb2bf;"> http://127.0.0.1:4040/api/tunnels </span><span style="color:#db9d63;">2</span><span style="color:#adb7c9;">&gt;&amp;</span><span style="color:#db9d63;">1 </span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> /home/pi/logs/ngrok_details.log
</span></code></pre>
<p><img src="/images/connected-roomba-demo.gif" alt="Remote Roomba Demo" title="Remote Roomba Demo" /></p>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>Since this was my first project interacting with an embedded system I learned
quite a bit along the way. Abstractions are something that are useful, but can
add bloat and load that won't work in constrained environments. I wasn't able
to use the Roomba library I built with the Circuit Playground on the Feather
that I connected to the Roomba. CircuitPython made learning and prototyping
easy with a REPL and constant connection to the Open Interface. It also allowed
me to focus on learning more about the boards and data interactions since I
wasn't busy rebuilding my software toolchain for a new environment. That said
it has also inspired me to learn more and dig deeper into the embedded world
since there are a lot of things I can't user (interupts). There is a lot that
I don't know or understand yet, but with the help of some books and boards I
am sure I will be busy expanding my understanding for the next few years.</p>
<h3 id="contact">Contact</h3>
<p>I really enjoyed working on this project. If you want to reach out feel free
to follow up via <a href="mailto:n0mn0m@burningdaylight.io">email</a> or on
.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="field">
        <p class="control has-icons-right">
          <input class="input" id="search" placeholder="Search this website." type="search" />
          <span class="icon is-small is-right">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


   
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;async-postgres-locks&#x2F;"
            >
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Postgres Advisory Locks with Asyncio
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;connected-roomba-remote-commands&#x2F;"
            >
              Connected Roomba - SMS<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>
 

    

  
  <footer class="py-4 has-background-light">
    <p class="has-text-centered">
      Built with
      <span class="icon is-small">
        <i class="fas fa-code fa-xs"></i>
      </span>
      code and
      <span class="icon is-small">
        <i class="fas fa-heart fa-xs"></i>
      </span>
      love <br /> Powered By
      <span class="icon is-small">
        <i class="fas fa-power-off fa-xs"></i>
      </span>
      Zola <br />Posts licensed by <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 </a><i class="fa fa-cc"></i>
      <br /> Code licensed <a href="https://www.gnu.org/licenses/lgpl-3.0.txt">LGPL</a>
    </p>
  </footer>
  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1/dist/chart.xkcd.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;search_index.en.js'></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;js&#x2F;site.js'></script>

    
</body>

</html>