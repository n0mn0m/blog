<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  <link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />
  
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-icon.png' rel="apple-touch-icon" sizes="180x180" />
  

  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.css"
    rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <link href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;site.css' rel="stylesheet" />

  
  

  <title>
     burningdaylight | Train All the Things - Synthetic Generation 
  </title>

  <script crossorigin="anonymous" src="https://kit.fontawesome.com/201b8d5e05.js"></script>

  
</head>

<body class="has-background-white">
  
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item has-text-weight-bold" href="/">burningdaylight</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;'>
            Home
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts'>
            Posts
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;docs'>
            Docs
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;github.com&#x2F;n0mn0m'>
            Repos
          </a>
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  

  
  

  
<section class="section pb-0">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article>
          <h1 class="title">Train All the Things - Synthetic Generation</h1>
          <h2 class="subtitle"></h2>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="fas fa-user"></i>
    </span>
     published on
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2020-03-19'>March 19, 2020</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    4 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    638 words
  </p>

            </div>
            <div class="column is-4">
              
            </div>
            <div class="column is-8 has-text-right-desktop">
               
  <p>
    <span class="has-text-black has-text-weight-normal">Tags:</span>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;hackaday&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        hackaday
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;maker&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        maker
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;machine-learning&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        machine learning
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;train-all-the-things&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        train all the things
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;data&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        data
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;synthesis&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        synthesis
      </a>
    
  </p>
 
            </div>
          </div>
          <div class="content has-text-justified">
            <p>After getting the display and worker up and running I started down the path of
training my model for keyword recognition. Right now I've settled on the wake
words <code>Hi Smalltalk</code>. After the wake word is detected the model will then
detect <code>silence</code>, <code>on</code>, <code>off</code>, or <code>unknown</code>.</p>
<p>My starting point for training the model was the
<a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/lite/micro/examples/micro_speech"><code>micro_speech</code></a>
and
<a href="https://github.com/tensorflow/docs/blob/master/site/en/r1/tutorials/sequences/audio_recognition"><code>speech_commands</code></a>
tutorials that are part of the Tensorflow project. One of the first things I
noticed while planning out this step was the lack of good wake words in the
speech command dataset. There are
<a href="https://github.com/jim-schwoebel/voice_datasets">many</a> voice datasets available
online, but many are unlabeled or conversational. Since digging didn't turn up
much in the way of open labeled word datasets I decided to use <code>on</code> and <code>off</code>
from the speech commands
<a href="https://ai.googleblog.com/2017/08/launching-speech-commands-dataset.html">dataset</a>
since that gave me a baseline for comparison with my custom words. After
recording myself saying <code>hi</code> and <code>smalltalk</code> less then ten times I knew I did
not want to generate my own samples at the scale of the other labeled keywords.</p>
<p>Instead of giving up on my wake word combination I started digging around for
options and found an interesting
<a href="https://github.com/JohannesBuchner/spoken-command-recognition">project</a> where
somebody had started down the path of generating labeled words with text to
speech. After reading through the repo I ended up using
<a href="http://espeak.sourceforge.net/">espeak</a> and <a href="http://sox.sourceforge.net/">sox</a>
to generate my labeled dataset.</p>
<p>The first step was to generate the
<a href="https://en.wikipedia.org/wiki/Phoneme">phonemes</a> for the wake words:</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#eb6772;">$</span><span style="color:#abb2bf;"> espeak</span><span style="color:#eb6772;"> -v</span><span style="color:#abb2bf;"> en</span><span style="color:#eb6772;"> -X</span><span style="color:#abb2bf;"> smalltalk
 </span><span style="color:#eb6772;">sm</span><span style="color:#9acc76;">&#39;O:ltO:k
</span></code></pre>
<p>I then stored the phoneme in a word file that will be used by <code>generate.sh</code>.</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="color:#eb6772;">$</span><span style="color:#abb2bf;"> cat words
</span><span style="color:#eb6772;">hi</span><span style="color:#abb2bf;"> 001 </span><span style="color:#cd74e8;">[</span><span style="color:#abb2bf;">[h</span><span style="color:#9acc76;">&#39;aI]]
busy 002 [[b&#39;</span><span style="color:#abb2bf;">Izi</span><span style="color:#cd74e8;">]</span><span style="color:#abb2bf;">]
</span><span style="color:#eb6772;">free</span><span style="color:#abb2bf;"> 003 </span><span style="color:#cd74e8;">[</span><span style="color:#abb2bf;">[fr</span><span style="color:#9acc76;">&#39;i:]]
smalltalk 004 [[sm&#39;</span><span style="color:#abb2bf;">O:ltO:k</span><span style="color:#cd74e8;">]</span><span style="color:#abb2bf;">]
</span></code></pre>
<p>After modifying <code>generate.sh</code> from the spoken command repo (eliminating some
extra commands and extending the loop to generating more samples) I had
everything I needed to synthetically generate a new labeled word dataset.</p>
<pre style="background-color:#2b303b;">
<code class="language-bash" data-lang="bash"><span style="font-style:italic;color:#5f697a;">#!/bin/bash
# For the various loops the variable stored in the index variable
# is used to attenuate the voices being created from espeak.

</span><span style="color:#eb6772;">lastwordid</span><span style="color:#adb7c9;">=</span><span style="color:#9acc76;">&quot;&quot;

</span><span style="color:#eb6772;">cat</span><span style="color:#abb2bf;"> words </span><span style="color:#adb7c9;">| </span><span style="color:#cd74e8;">while </span><span style="color:#5ebfcc;">read</span><span style="color:#abb2bf;"> word wordid phoneme

</span><span style="color:#cd74e8;">do
    </span><span style="color:#5ebfcc;">echo </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">word
    mkdir -p</span><span style="color:#abb2bf;"> db/$</span><span style="color:#eb6772;">word

    </span><span style="color:#cd74e8;">if </span><span style="color:#5ebfcc;">[[ </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">word </span><span style="color:#adb7c9;">!= </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">lastword </span><span style="color:#5ebfcc;">]]</span><span style="color:#adb7c9;">; </span><span style="color:#cd74e8;">then
        </span><span style="color:#eb6772;">versionid</span><span style="color:#adb7c9;">=</span><span style="color:#9acc76;">0
    </span><span style="color:#cd74e8;">fi

    </span><span style="color:#eb6772;">lastword</span><span style="color:#adb7c9;">=</span><span style="color:#9acc76;">$</span><span style="color:#eb6772;">word

    </span><span style="font-style:italic;color:#5f697a;"># Generate voices with various dialects
    </span><span style="color:#cd74e8;">for</span><span style="color:#abb2bf;"> i </span><span style="color:#cd74e8;">in</span><span style="color:#abb2bf;"> english english-north en-scottish english_rp english_wmids english-us en-westindies
    </span><span style="color:#cd74e8;">do
        </span><span style="font-style:italic;color:#5f697a;"># Loop changing the pitch in each iteration
        </span><span style="color:#cd74e8;">for</span><span style="color:#abb2bf;"> k </span><span style="color:#cd74e8;">in </span><span style="color:#abb2bf;">$(</span><span style="color:#eb6772;">seq</span><span style="color:#abb2bf;"> 1 99)
        </span><span style="color:#cd74e8;">do
            </span><span style="font-style:italic;color:#5f697a;"># Change the speed of words per minute
            </span><span style="color:#cd74e8;">for</span><span style="color:#abb2bf;"> j </span><span style="color:#cd74e8;">in</span><span style="color:#abb2bf;"> 80 100 120 140 160</span><span style="color:#adb7c9;">; </span><span style="color:#cd74e8;">do
                </span><span style="color:#5ebfcc;">echo </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">versionid </span><span style="color:#9acc76;">&quot;$</span><span style="color:#eb6772;">phoneme</span><span style="color:#9acc76;">&quot; </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">i </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">j </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">k
                </span><span style="color:#5ebfcc;">echo </span><span style="color:#9acc76;">&quot;$</span><span style="color:#eb6772;">phoneme</span><span style="color:#9acc76;">&quot; </span><span style="color:#adb7c9;">| </span><span style="color:#eb6772;">espeak -p </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">k -s </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">j -v </span><span style="color:#abb2bf;">$</span><span style="color:#eb6772;">i -w</span><span style="color:#abb2bf;"> db/$</span><span style="color:#eb6772;">word</span><span style="color:#abb2bf;">/$</span><span style="color:#eb6772;">versionid</span><span style="color:#abb2bf;">.wav
                </span><span style="font-style:italic;color:#5f697a;"># Set sox options for Tensorflow
</span><span style="color:#abb2bf;">                sox db/$</span><span style="color:#eb6772;">word</span><span style="color:#abb2bf;">/$</span><span style="color:#eb6772;">versionid</span><span style="color:#abb2bf;">.wav</span><span style="color:#eb6772;"> -b</span><span style="color:#abb2bf;"> 16</span><span style="color:#eb6772;"> --endian</span><span style="color:#abb2bf;"> little db/$</span><span style="color:#eb6772;">word</span><span style="color:#abb2bf;">/tf_$</span><span style="color:#eb6772;">versionid</span><span style="color:#abb2bf;">.wav rate 16k
                ((versionid</span><span style="color:#adb7c9;">++</span><span style="color:#abb2bf;">))
            </span><span style="color:#cd74e8;">done
        done
    done
done
</span></code></pre>
<p>After the run I have samples and labels with a volume comparable to the other
words provided by Google. The pitch, speed and tone of voice changes with each
loop which will hopefully provide enough variety to make this dataset useful in
training. Even if this doesn't work out learning about <code>espeak</code> and <code>sox</code> was
interesting. I've already got some future ideas on how to use those. If it does
work the ability to generate training data on demand seems incredibly useful.</p>
<p>Next up, training the model and loading to the ESP-EYE. The code, docs, images
etc for the project can be found <a href="https://github.com/n0mn0m/on-air">here</a> and
I'll be posting updates as I continue along to
<a href="https://hackaday.io/project/170228-on-air">HackadayIO</a> and this blog. If you
have any questions or ideas reach <a href="mailto:n0mn0m@burningdaylight.io">out</a>.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="field">
        <p class="control has-icons-right">
          <input class="input" id="search" placeholder="Search this website." type="search" />
          <span class="icon is-small is-right">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


   
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;train-all-the-things-custom-model&#x2F;"
            >
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Train All the Things - Model Training
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;train-all-the-things-display&#x2F;"
            >
              Train All the Things - Display<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>
 

    

  
  <footer class="py-4 has-background-light">
    <p class="has-text-centered">
      Built with
      <span class="icon is-small">
        <i class="fas fa-code fa-xs"></i>
      </span>
      code and
      <span class="icon is-small">
        <i class="fas fa-heart fa-xs"></i>
      </span>
      love <br /> Powered By
      <span class="icon is-small">
        <i class="fas fa-power-off fa-xs"></i>
      </span>
      Zola <br />Posts licensed by <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 </a><i class="fa fa-cc"></i>
      <br /> Code licensed <a href="https://www.gnu.org/licenses/lgpl-3.0.txt">LGPL</a>
    </p>
  </footer>
  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1/dist/chart.xkcd.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;search_index.en.js'></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;js&#x2F;site.js'></script>

    
</body>

</html>