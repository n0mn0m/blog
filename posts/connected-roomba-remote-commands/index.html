<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  <link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />
  
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-icon.png' rel="apple-touch-icon" sizes="180x180" />
  

  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.css"
    rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <link href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;site.css' rel="stylesheet" />

  
  

  <title>
     burningdaylight | Connected Roomba - SMS 
  </title>

  <script crossorigin="anonymous" src="https://kit.fontawesome.com/201b8d5e05.js"></script>

  
</head>

<body class="has-background-white">
  
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item has-text-weight-bold" href="/">burningdaylight</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;'>
            Home
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts'>
            Posts
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;docs'>
            Docs
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;github.com&#x2F;n0mn0m'>
            Repos
          </a>
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  

  
  

  
<section class="section pb-0">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article>
          <h1 class="title">Connected Roomba - SMS</h1>
          <h2 class="subtitle"></h2>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="fas fa-user"></i>
    </span>
     published on
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2019-08-03'>August 03, 2019</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    2 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    362 words
  </p>

            </div>
            <div class="column is-4">
              
            </div>
            <div class="column is-8 has-text-right-desktop">
               
  <p>
    <span class="has-text-black has-text-weight-normal">Tags:</span>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;circuitpython&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        circuitpython
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;python&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        python
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;hardware&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        hardware
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;irobot&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        irobot
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;roomba&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        roomba
      </a>
    
  </p>
 
            </div>
          </div>
          <div class="content has-text-justified">
            <p>As I mentioned before one of the primary reasons for starting this project was
to let my wife and I start the Roomba when we are not at home. One device that
most of us take everywhere is our phone. An easy way to to send information
from your phone without a custom app, stack and hassle is SMS. While it's easy
to broadcast receiving that message can take a little work.</p>
<h2 id="twilio">Twilio</h2>
<p>Luckily monitoring a number for messages is pretty much a solved problem.
Twilio offers an easy way to setup number with an attached webhook for
receiving and sending messages. They also have a nice
<a href="https://www.twilio.com/docs/quickstart/python">Python tutorial</a> that had me up
and running in about 10 minutes. Since I was already using the Pi Zero to send
commands to the Roomba setting up a script to watch for an SMS message and pass
on the new command was simple enough.</p>
<pre style="background-color:#2b303b;">
<code class="language-python" data-lang="python"><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">busio
</span><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">board
</span><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">adafruit_rfm9x
</span><span style="color:#cd74e8;">from </span><span style="color:#abb2bf;">digitalio </span><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">DigitalInOut
</span><span style="color:#cd74e8;">from </span><span style="color:#abb2bf;">flask </span><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">Flask, request
</span><span style="color:#cd74e8;">from </span><span style="color:#abb2bf;">twilio.twiml.messaging_response </span><span style="color:#cd74e8;">import </span><span style="color:#abb2bf;">MessagingResponse

</span><span style="color:#eb6772;">CS </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">DigitalInOut</span><span style="color:#abb2bf;">(board.</span><span style="color:#eb6772;">CE1</span><span style="color:#abb2bf;">)
</span><span style="color:#eb6772;">RESET </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">DigitalInOut</span><span style="color:#abb2bf;">(board.D25)
spi </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">busio.</span><span style="color:#eb6772;">SPI</span><span style="color:#abb2bf;">(board.</span><span style="color:#eb6772;">SCK</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">MOSI</span><span style="color:#adb7c9;">=</span><span style="color:#abb2bf;">board.</span><span style="color:#eb6772;">MOSI</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">MISO</span><span style="color:#adb7c9;">=</span><span style="color:#abb2bf;">board.</span><span style="color:#eb6772;">MISO</span><span style="color:#abb2bf;">)
rfm9x </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">adafruit_rfm9x.</span><span style="color:#eb6772;">RFM9x</span><span style="color:#abb2bf;">(spi, </span><span style="color:#eb6772;">CS</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">RESET</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">433.0</span><span style="color:#abb2bf;">)
rfm9x.tx_power </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">23

</span><span style="color:#abb2bf;">app </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">Flask</span><span style="color:#abb2bf;">(__name__)


@app.</span><span style="color:#eb6772;">route</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;/sms&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">methods</span><span style="color:#adb7c9;">=</span><span style="color:#abb2bf;">[</span><span style="color:#9acc76;">&quot;GET&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;POST&quot;</span><span style="color:#abb2bf;">])
</span><span style="color:#cd74e8;">def </span><span style="color:#5cb3fa;">sms_start_roomba</span><span style="color:#abb2bf;">():
    </span><span style="font-style:italic;color:#5f697a;">&quot;&quot;&quot;
    When a message is received determine which
    signal to send  the Roomba and reply
    to the sender.
    &quot;&quot;&quot;

    </span><span style="color:#abb2bf;">txt </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">request.values.</span><span style="color:#eb6772;">get</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;Body&quot;</span><span style="color:#abb2bf;">).</span><span style="color:#eb6772;">lower</span><span style="color:#abb2bf;">()

    </span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">txt </span><span style="color:#adb7c9;">== </span><span style="color:#9acc76;">&quot;start&quot;</span><span style="color:#abb2bf;">:
        msg </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;Starting the Roomba.&quot;
        </span><span style="color:#abb2bf;">cmd </span><span style="color:#adb7c9;">= </span><span style="color:#5ebfcc;">bytes</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;1&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;ascii&quot;</span><span style="color:#abb2bf;">)
    </span><span style="color:#cd74e8;">elif </span><span style="color:#abb2bf;">txt </span><span style="color:#adb7c9;">== </span><span style="color:#9acc76;">&quot;halt&quot;</span><span style="color:#abb2bf;">:
        msg </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;Stopping the Roomba.&quot;
        </span><span style="color:#abb2bf;">cmd </span><span style="color:#adb7c9;">= </span><span style="color:#5ebfcc;">bytes</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;0&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;ascii&quot;</span><span style="color:#abb2bf;">)
    </span><span style="color:#cd74e8;">elif </span><span style="color:#abb2bf;">txt </span><span style="color:#adb7c9;">== </span><span style="color:#9acc76;">&quot;dock&quot;</span><span style="color:#abb2bf;">:
        msg </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;Roomba beginning to dock.&quot;
        </span><span style="color:#abb2bf;">cmd </span><span style="color:#adb7c9;">= </span><span style="color:#5ebfcc;">bytes</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;2&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;ascii&quot;</span><span style="color:#abb2bf;">)
    </span><span style="color:#cd74e8;">else</span><span style="color:#abb2bf;">:
        msg </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;Unknown command. Continuing.&quot;
        </span><span style="color:#abb2bf;">cmd </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">None

    </span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">cmd:
        rfm9x.</span><span style="color:#eb6772;">send</span><span style="color:#abb2bf;">(cmd)

    resp </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">MessagingResponse</span><span style="color:#abb2bf;">()
    resp.</span><span style="color:#eb6772;">message</span><span style="color:#abb2bf;">(msg)

    </span><span style="color:#cd74e8;">return </span><span style="color:#5ebfcc;">str</span><span style="color:#abb2bf;">(resp)


</span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">__name__ </span><span style="color:#adb7c9;">== </span><span style="color:#9acc76;">&quot;__main__&quot;</span><span style="color:#abb2bf;">:
        app.</span><span style="color:#eb6772;">run</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">debug</span><span style="color:#adb7c9;">=</span><span style="color:#db9d63;">False</span><span style="color:#abb2bf;">)

</span></code></pre>
<p>And with that the same board I had used to test sending messages in response to
button clicks can now receive SMS payloads and translate that into a command
that the Feather will use to start, stop or dock the Roomba.</p>
<h3 id="next-steps">Next Steps</h3>
<p>With all the pieces assembled and working the last thing to do for version 1
was setup some redundancy, restart everything and make sure it all worked as
expected without my intervention.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="field">
        <p class="control has-icons-right">
          <input class="input" id="search" placeholder="Search this website." type="search" />
          <span class="icon is-small is-right">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


   
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;connected-roomba-wrap-up&#x2F;"
            >
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Connected Roomba - Wrapping Up
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;connected-roomba-lora&#x2F;"
            >
              Connected Roomba Remote - LoRa<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>
 

    

  
  <footer class="py-4 has-background-light">
    <p class="has-text-centered">
      Built with
      <span class="icon is-small">
        <i class="fas fa-code fa-xs"></i>
      </span>
      code and
      <span class="icon is-small">
        <i class="fas fa-heart fa-xs"></i>
      </span>
      love <br /> Powered By
      <span class="icon is-small">
        <i class="fas fa-power-off fa-xs"></i>
      </span>
      Zola <br />Posts licensed by <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 </a><i class="fa fa-cc"></i>
      <br /> Code licensed <a href="https://www.gnu.org/licenses/lgpl-3.0.txt">LGPL</a>
    </p>
  </footer>
  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1/dist/chart.xkcd.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;search_index.en.js'></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;js&#x2F;site.js'></script>

    
</body>

</html>