<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  <link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />
  
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-icon.png' rel="apple-touch-icon" sizes="180x180" />
  

  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.css"
    rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <link href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;site.css' rel="stylesheet" />

  
  

  <title>
     burningdaylight | Connected Roomba Remote - LoRa 
  </title>

  <script crossorigin="anonymous" src="https://kit.fontawesome.com/201b8d5e05.js"></script>

  
</head>

<body class="has-background-white">
  
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item has-text-weight-bold" href="/">burningdaylight</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;'>
            Home
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts'>
            Posts
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;docs'>
            Docs
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;github.com&#x2F;n0mn0m'>
            Repos
          </a>
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  

  
  

  
<section class="section pb-0">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article>
          <h1 class="title">Connected Roomba Remote - LoRa</h1>
          <h2 class="subtitle"></h2>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="fas fa-user"></i>
    </span>
     published on
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2019-08-02'>August 02, 2019</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    4 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    664 words
  </p>

            </div>
            <div class="column is-4">
              
            </div>
            <div class="column is-8 has-text-right-desktop">
               
  <p>
    <span class="has-text-black has-text-weight-normal">Tags:</span>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;circuitpython&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        circuitpython
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;python&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        python
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;hardware&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        hardware
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;adafruit&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        adafruit
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;irobot&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        irobot
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;roomba&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        roomba
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;lora&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        lora
      </a>
    
  </p>
 
            </div>
          </div>
          <div class="content has-text-justified">
            <p>With a basic setup working the next thing I wanted to do was make communication
wireless. Thinking about my options I ruled out using WiFi pretty quick since I
didn't want to worry about discovery and router issues. I thought about
Bluetooth since I could send commands from my phone to the board on the Roomba,
but decided against it due to my lack of mobile programming experience and not
wanting to add yet another new thing to learn. (Side note I've since learned
about the
<a href="https://learn.adafruit.com/bluefruit-le-connect/features">Bluefruit app</a>)
Looking at the other <a href="https://www.adafruit.com/feather">Feather</a> options I
decided to make use of
<a href="https://learn.adafruit.com/adafruit-feather/lora-radio-feathers">LoRa</a>
for my communication layer since it would be easy to use, my packets are tiny
and I didn't have to worry about software beyond CircuitPython.</p>
<h2 id="the-boards">The boards</h2>
<p>With the protocol determined and sticking with CircuitPython I found a
<a href="https://www.adafruit.com/product/3179">Feather</a> with LoRa built in, and a
<a href="https://www.adafruit.com/product/4074">Pi Zero Bonnet</a> with some buttons and a
small display that would make testing easier. After reading through the
<a href="https://learn.adafruit.com/adafruit-feather-m0-radio-with-lora-radio-module">docs</a>
and
<a href="https://learn.adafruit.com/lora-and-lorawan-radio-for-raspberry-pi/rfm9x-raspberry-pi-setup">tutorials</a>
for both boards I began work on signalling the Roomba to start with the push of
a button.</p>
<p>One of the first road blocks I ran into was of my own creation. The Roomba
library I wrote for prototyping was too big for the Feather. The good news was
<code>OpenInterface</code> was still useful, and there was plenty of room for the base
class after removing the debug and abstraction code, so I only compiled the
commands I knew I was going to use for version 1 and continued moving forward.</p>
<pre style="background-color:#2b303b;">
<code class="language-python" data-lang="python"><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">OpenInterface</span><span style="color:#adb7c9;">:
    </span><span style="color:#cd74e8;">def </span><span style="color:#5ebfcc;">__init__</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">tx_pin</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">rx_pin</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">brc_pin</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">baud_rate</span><span style="color:#adb7c9;">=</span><span style="color:#db9d63;">115200</span><span style="color:#abb2bf;">):
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._board </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">busio.</span><span style="color:#eb6772;">UART</span><span style="color:#abb2bf;">(tx_pin, rx_pin, </span><span style="color:#eb6772;">baudrate</span><span style="color:#adb7c9;">=</span><span style="color:#abb2bf;">baud_rate)
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._tx_pin </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">tx_pin
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._rx_pin </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">rx_pin
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._brc_pin </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">brc_pin
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._brc_pin.direction </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">digitalio.Direction.</span><span style="color:#eb6772;">OUTPUT
        self</span><span style="color:#abb2bf;">._baud_rate </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">baud_rate
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._stopped </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">True

    </span><span style="color:#cd74e8;">def </span><span style="color:#5cb3fa;">start</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">):
        </span><span style="color:#cd74e8;">if </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._stopped:
            </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">wake_up</span><span style="color:#abb2bf;">()

        </span><span style="color:#cd74e8;">for </span><span style="color:#abb2bf;">command </span><span style="color:#cd74e8;">in </span><span style="color:#abb2bf;">(</span><span style="color:#cd74e8;">b</span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\x80</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#cd74e8;">b</span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\x83</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#cd74e8;">b</span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\x87</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">):
            </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._board.</span><span style="color:#eb6772;">write</span><span style="color:#abb2bf;">(command)

    </span><span style="color:#cd74e8;">def </span><span style="color:#5cb3fa;">stop</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">):
        </span><span style="color:#cd74e8;">for </span><span style="color:#abb2bf;">command </span><span style="color:#cd74e8;">in </span><span style="color:#abb2bf;">(</span><span style="color:#cd74e8;">b</span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\x85</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#cd74e8;">b</span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\xAD</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">):
            </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._board.</span><span style="color:#eb6772;">write</span><span style="color:#abb2bf;">(command)
        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._stopped </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">True

    </span><span style="color:#cd74e8;">def </span><span style="color:#5cb3fa;">wake_up</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">):
        </span><span style="color:#cd74e8;">for </span><span style="color:#abb2bf;">i </span><span style="color:#cd74e8;">in </span><span style="color:#5ebfcc;">range</span><span style="color:#abb2bf;">(</span><span style="color:#db9d63;">3</span><span style="color:#abb2bf;">):
            </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._brc_pin.value </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">False
            </span><span style="color:#abb2bf;">time.</span><span style="color:#eb6772;">sleep</span><span style="color:#abb2bf;">(</span><span style="color:#db9d63;">0.5</span><span style="color:#abb2bf;">)
            </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._brc_pin.value </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">True
            </span><span style="color:#abb2bf;">time.</span><span style="color:#eb6772;">sleep</span><span style="color:#abb2bf;">(</span><span style="color:#db9d63;">0.5</span><span style="color:#abb2bf;">)
            </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._brc_pin.value </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">False
            </span><span style="color:#abb2bf;">time.</span><span style="color:#eb6772;">sleep</span><span style="color:#abb2bf;">(</span><span style="color:#db9d63;">0.5</span><span style="color:#abb2bf;">)

        </span><span style="color:#eb6772;">self</span><span style="color:#abb2bf;">._stopped </span><span style="color:#adb7c9;">= </span><span style="color:#db9d63;">False

</span></code></pre>
<p>After stripping things down and getting the Feather to start and stop the
Roomba from the REPL I turned my attention to the Pi.</p>
<p><img src="/images/connected-roomba-full.jpg" alt="Interface Connections" /></p>
<p>With the Pi Zero providing more resources installing the OS, setting up SSH and
compiling Python 3.7 took more time then getting the Circuit Python libraries
working. <a href="https://pypi.org/project/Adafruit-Blinka/">Blinka</a> worked like a
charm and following the docs from above I had a quick
<a href="https://github.com/n0mn0m/bot_commander/tree/main/pi/button_listener.py">script</a>
to send <code>start</code> and <code>stop</code> packets via LoRa working in no time.</p>
<pre style="background-color:#2b303b;">
<code class="language-python" data-lang="python"><span style="color:#cd74e8;">while </span><span style="color:#db9d63;">True</span><span style="color:#abb2bf;">:
    </span><span style="color:#cd74e8;">try</span><span style="color:#abb2bf;">:
        </span><span style="color:#cd74e8;">if not </span><span style="color:#abb2bf;">start_button.value:
            msg </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;Starting Roomba.&quot;
            </span><span style="color:#abb2bf;">logger.</span><span style="color:#eb6772;">info</span><span style="color:#abb2bf;">(msg)
            rfm9x.</span><span style="color:#eb6772;">send</span><span style="color:#abb2bf;">(</span><span style="color:#5ebfcc;">bytes</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;1&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;ascii&quot;</span><span style="color:#abb2bf;">))
            display.</span><span style="color:#eb6772;">fill</span><span style="color:#abb2bf;">(</span><span style="color:#db9d63;">0</span><span style="color:#abb2bf;">)
            display.</span><span style="color:#eb6772;">text</span><span style="color:#abb2bf;">(msg, </span><span style="color:#db9d63;">25</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">15</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">1</span><span style="color:#abb2bf;">)
        </span><span style="color:#cd74e8;">elif not </span><span style="color:#abb2bf;">stop_button.value:
            msg </span><span style="color:#adb7c9;">= </span><span style="color:#9acc76;">&quot;Stopping Roomba.&quot;
            </span><span style="color:#abb2bf;">logger.</span><span style="color:#eb6772;">info</span><span style="color:#abb2bf;">(msg)
            rfm9x.</span><span style="color:#eb6772;">send</span><span style="color:#abb2bf;">(</span><span style="color:#5ebfcc;">bytes</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;0&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;ascii&quot;</span><span style="color:#abb2bf;">))
            display.</span><span style="color:#eb6772;">fill</span><span style="color:#abb2bf;">(</span><span style="color:#db9d63;">0</span><span style="color:#abb2bf;">)
            display.</span><span style="color:#eb6772;">text</span><span style="color:#abb2bf;">(msg, </span><span style="color:#db9d63;">25</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">15</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">1</span><span style="color:#abb2bf;">)
</span></code></pre>
<p>The display on the bonnet was a nice touch so that I could watch the Feather in
a terminal while the Pi let me know immediately which button was pressed and
which command I should expect the Feather to receive.</p>
<p><img src="/images/connected-roomba-pi-start.jpg" alt="Pi Bonnet Display" /></p>
<h3 id="next-steps">Next Steps</h3>
<p>With the boards talking to each other and the ability to start/stop the Roomba
with the press of a button the last thing to do was make this work when we are
not at home. While LoRa has a pretty good range I wanted this to work for my
wife and I without having to worry about where we are. In part 3 I look at
making this work with SMS.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="field">
        <p class="control has-icons-right">
          <input class="input" id="search" placeholder="Search this website." type="search" />
          <span class="icon is-small is-right">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


   
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;connected-roomba-remote-commands&#x2F;"
            >
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Connected Roomba - SMS
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;connected-roomba-prototype&#x2F;"
            >
              Connected Roomba - Possibilities<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>
 

    

  
  <footer class="py-4 has-background-light">
    <p class="has-text-centered">
      Built with
      <span class="icon is-small">
        <i class="fas fa-code fa-xs"></i>
      </span>
      code and
      <span class="icon is-small">
        <i class="fas fa-heart fa-xs"></i>
      </span>
      love <br /> Powered By
      <span class="icon is-small">
        <i class="fas fa-power-off fa-xs"></i>
      </span>
      Zola <br />Posts licensed by <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 </a><i class="fa fa-cc"></i>
      <br /> Code licensed <a href="https://www.gnu.org/licenses/lgpl-3.0.txt">LGPL</a>
    </p>
  </footer>
  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1/dist/chart.xkcd.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;search_index.en.js'></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;js&#x2F;site.js'></script>

    
</body>

</html>