<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  <link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />
  
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-icon.png' rel="apple-touch-icon" sizes="180x180" />
  

  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.css"
    rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <link href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;site.css' rel="stylesheet" />

  
  

  <title>
     burningdaylight | Train All the Things - Signaling 
  </title>

  <script crossorigin="anonymous" src="https://kit.fontawesome.com/201b8d5e05.js"></script>

  
</head>

<body class="has-background-white">
  
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item has-text-weight-bold" href="/">burningdaylight</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;'>
            Home
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts'>
            Posts
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;docs'>
            Docs
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;git.burningdaylight.io'>
            Repos
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;youtrack.burningdaylight.io&#x2F;projects'>
            Projects
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;teamcity.burningdaylight.io&#x2F;overview.html?guest=1'>
            Builds
          </a>
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  

  
  

  
<section class="section pb-0">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article>
          <h1 class="title">Train All the Things - Signaling</h1>
          <h2 class="subtitle"></h2>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="fas fa-user"></i>
    </span>
     published on
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2020-03-01'>March 01, 2020</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    2 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    314 words
  </p>

            </div>
            <div class="column is-4">
              
            </div>
            <div class="column is-8 has-text-right-desktop">
               
  <p>
    <span class="has-text-black has-text-weight-normal">Tags:</span>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;hackaday&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        hackaday
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;machine-learning&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        machine learning
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;train-all-the-things&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        train all the things
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;edge&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        edge
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;javascript&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        javascript
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;serverless&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        serverless
      </a>
    
      <a class="link has-text-weight-light" href='https:&#x2F;&#x2F;burningdaylight.io&#x2F;tags&#x2F;faas&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        faas
      </a>
    
  </p>
 
            </div>
          </div>
          <div class="content has-text-justified">
            <p>After <a href="https://burningdaylight.io/posts/train-all-the-things-planning/">figuring out</a> what I was
going to use for my project I started work with things I know. I already had
some experience with Cloudflare workers building a
<a href="https://burningdaylight.io/posts/system-status-observer/">home system status</a> page, and Workers K/V
makes storing and fetching data quick and easy. I ended up with a simple
endpoint that I <code>POST</code> to set a bit after keyword detection, and the PyPortal
retrieves that status to determine what to display:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#cd74e8;">const </span><span style="color:#adb7c9;">setCache = </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">key</span><span style="color:#abb2bf;">, </span><span style="color:#adb7c9;">data</span><span style="color:#abb2bf;">) </span><span style="color:#cd74e8;">=&gt; </span><span style="color:#f0c678;">SIGNALS</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">put</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">key</span><span style="color:#abb2bf;">, </span><span style="color:#adb7c9;">data</span><span style="color:#abb2bf;">);
</span><span style="color:#cd74e8;">const </span><span style="color:#adb7c9;">getCache = key </span><span style="color:#cd74e8;">=&gt; </span><span style="color:#f0c678;">SIGNALS</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">get</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">key</span><span style="color:#abb2bf;">);

</span><span style="color:#cd74e8;">async function </span><span style="color:#5cb3fa;">getStatus</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">cacheKey</span><span style="color:#abb2bf;">) {
    </span><span style="color:#cd74e8;">var </span><span style="color:#adb7c9;">serviceStat = </span><span style="color:#cd74e8;">await </span><span style="color:#eb6772;">getCache</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">cacheKey</span><span style="color:#abb2bf;">);

    </span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">!serviceStat</span><span style="color:#abb2bf;">) {
        </span><span style="color:#cd74e8;">return </span><span style="color:#adb7c9;">new </span><span style="color:#eb6772;">Response</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;invalid status key&#39;</span><span style="color:#abb2bf;">, { status: </span><span style="color:#db9d63;">500 </span><span style="color:#abb2bf;">});
    } </span><span style="color:#cd74e8;">else </span><span style="color:#abb2bf;">{
        </span><span style="color:#cd74e8;">return </span><span style="color:#adb7c9;">new </span><span style="color:#eb6772;">Response</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">serviceStat</span><span style="color:#abb2bf;">, {status: </span><span style="color:#db9d63;">200</span><span style="color:#abb2bf;">});
    }
}

</span><span style="color:#cd74e8;">async function </span><span style="color:#5cb3fa;">setStatus</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">cacheKey</span><span style="color:#abb2bf;">, </span><span style="color:#adb7c9;">cacheValue</span><span style="color:#abb2bf;">) {
    </span><span style="color:#cd74e8;">try </span><span style="color:#abb2bf;">{
        </span><span style="color:#cd74e8;">await </span><span style="color:#eb6772;">setCache</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">cacheKey</span><span style="color:#abb2bf;">, </span><span style="color:#adb7c9;">cacheValue</span><span style="color:#abb2bf;">);
        </span><span style="color:#cd74e8;">return </span><span style="color:#adb7c9;">new </span><span style="color:#eb6772;">Response</span><span style="color:#abb2bf;">((</span><span style="color:#adb7c9;">cacheKey + </span><span style="color:#9acc76;">&quot; set to &quot; </span><span style="color:#adb7c9;">+ cacheValue + </span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\n</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">), { status: </span><span style="color:#db9d63;">200 </span><span style="color:#abb2bf;">});
    } </span><span style="color:#cd74e8;">catch </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">err</span><span style="color:#abb2bf;">) {
        </span><span style="color:#cd74e8;">return </span><span style="color:#adb7c9;">new </span><span style="color:#eb6772;">Response</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">err</span><span style="color:#abb2bf;">, { status: </span><span style="color:#db9d63;">500 </span><span style="color:#abb2bf;">});
    }
}

</span><span style="color:#cd74e8;">async function </span><span style="color:#5cb3fa;">handleRequest</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">request</span><span style="color:#abb2bf;">) {
    </span><span style="color:#cd74e8;">var </span><span style="color:#adb7c9;">psk = </span><span style="color:#cd74e8;">await </span><span style="color:#eb6772;">getCache</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;PSK&quot;</span><span style="color:#abb2bf;">)
    </span><span style="color:#cd74e8;">let </span><span style="color:#adb7c9;">presharedKey = new </span><span style="color:#eb6772;">URL</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">request</span><span style="color:#abb2bf;">.url).searchParams.</span><span style="color:#eb6772;">get</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;psk&#39;</span><span style="color:#abb2bf;">);
    </span><span style="color:#cd74e8;">let </span><span style="color:#adb7c9;">statusKey = new </span><span style="color:#eb6772;">URL</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">request</span><span style="color:#abb2bf;">.url).searchParams.</span><span style="color:#eb6772;">get</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;service&#39;</span><span style="color:#abb2bf;">);
    </span><span style="color:#cd74e8;">let </span><span style="color:#adb7c9;">statusValue = new </span><span style="color:#eb6772;">URL</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">request</span><span style="color:#abb2bf;">.url).searchParams.</span><span style="color:#eb6772;">get</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;status&#39;</span><span style="color:#abb2bf;">);

    </span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">presharedKey === psk</span><span style="color:#abb2bf;">) {
        </span><span style="color:#cd74e8;">if </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">request</span><span style="color:#abb2bf;">.method </span><span style="color:#adb7c9;">=== </span><span style="color:#9acc76;">&#39;POST&#39;</span><span style="color:#abb2bf;">) {
            </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">setStatus</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">statusKey</span><span style="color:#abb2bf;">, </span><span style="color:#adb7c9;">statusValue</span><span style="color:#abb2bf;">);
        } </span><span style="color:#cd74e8;">else if </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">request</span><span style="color:#abb2bf;">.method </span><span style="color:#adb7c9;">=== </span><span style="color:#9acc76;">&#39;GET&#39; </span><span style="color:#adb7c9;">&amp;&amp; statusKey</span><span style="color:#abb2bf;">) {
            </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">getStatus</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">statusKey</span><span style="color:#abb2bf;">);
        } </span><span style="color:#cd74e8;">else </span><span style="color:#abb2bf;">{
            </span><span style="color:#cd74e8;">return </span><span style="color:#adb7c9;">new </span><span style="color:#eb6772;">Response</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;</span><span style="color:#5ebfcc;">\n</span><span style="color:#9acc76;">&quot;</span><span style="color:#abb2bf;">, { status: </span><span style="color:#db9d63;">418 </span><span style="color:#abb2bf;">});
        }
    } </span><span style="color:#cd74e8;">else </span><span style="color:#abb2bf;">{
        </span><span style="color:#cd74e8;">return </span><span style="color:#adb7c9;">new </span><span style="color:#eb6772;">Response</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&quot;Hello&quot;</span><span style="color:#abb2bf;">)
    }
}


</span><span style="color:#eb6772;">addEventListener</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;fetch&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#adb7c9;">event </span><span style="color:#cd74e8;">=&gt; </span><span style="color:#abb2bf;">{
    </span><span style="color:#adb7c9;">event</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">respondWith</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">handleRequest</span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">event</span><span style="color:#abb2bf;">.request))
})
</span></code></pre>
<p>Nothing tricky happening above, just checking the request, and calling the
appropriate function to store or fetch the status bit. With the function
deployed to my Cloudflare Worker and verified with some <code>GET</code> and <code>POST</code> calls
I was ready to move on to the <a href="https://burningdaylight.io/posts/train-all-the-things-display/">display</a>.</p>
<p>The code, docs, images etc for the project can be found
<a href="https://git.burningdaylight.io/on-air">here</a> and I'll be posting updates as I
continue along to <a href="https://hackaday.io/project/170228-on-air">HackadayIO</a> and
this blog. If you have any questions or ideas reach
<a href="mailto:n0mn0m@burningdaylight.io">out</a>.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="field">
        <p class="control has-icons-right">
          <input class="input" id="search" placeholder="Search this website." type="search" />
          <span class="icon is-small is-right">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


   
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;train-all-the-things-display&#x2F;"
            >
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Train All the Things - Display
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a
              class="button is-black is-outlined"
              href="https:&#x2F;&#x2F;burningdaylight.io&#x2F;posts&#x2F;system-status-observer&#x2F;"
            >
              A Simple Status Page<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>
 

    

  
  <footer class="py-4 has-background-light">
    <p class="has-text-centered">
      Built with
      <span class="icon is-small">
        <i class="fas fa-code fa-xs"></i>
      </span>
      code and
      <span class="icon is-small">
        <i class="fas fa-heart fa-xs"></i>
      </span>
      love <br /> Powered By
      <span class="icon is-small">
        <i class="fas fa-power-off fa-xs"></i>
      </span>
      Zola <br />Posts licensed by <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 </a><i class="fa fa-cc"></i>
      <br /> Code licensed <a href="https://www.gnu.org/licenses/lgpl-3.0.txt">LGPL</a>
    </p>
  </footer>
  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1/dist/chart.xkcd.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;search_index.en.js'></script>
  <script src='https:&#x2F;&#x2F;burningdaylight.io&#x2F;js&#x2F;site.js'></script>

    
</body>

</html>